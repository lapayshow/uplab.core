!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=11)}({11:function(t,e,n){t.exports=n(12)},12:function(t,e,n){window.canvasAreaDraw=n(13),window.initCanvasResize=function(t){var e,n=0,o=document.querySelector(t);if(o){var r=function t(){var r=$(o).find("canvas"),f=function(){console.log("resize canvas ... early"),n<15&&(n++,e=setTimeout(t,50))};if(!r.length)return f();var i=r.attr("width"),u=r.attr("height");if(!i||!u)return f();var s,c=Math.max(900,window.innerWidth-420),l=c/i,h=Math.max(600,window.innerHeight-150),g=h/u;l<g?h=u*(s=l):c=i*(s=g),r.css({transform:"scale(".concat(s,")"),transformOrigin:"0 0",position:"absolute",marginTop:"50px"}),console.log("resize canvas ... to ".concat(c,"x").concat(h)),$(o).find(".canvas-placeholder").css({width:c,height:h}),a.disconnect()},a=new MutationObserver(function(){clearTimeout(e),e=setTimeout(r,50)});a.observe(o,{attributes:!0,childList:!0,subtree:!0})}}},13:function(t,e){!function(t){t.fn.canvasAreaDraw=function(t){this.each(function(n,o){e.apply(o,[n,o,t])})};var e=function(e,o,r){var a,f,i,u,s,c,l,h,g,d,p=!1;e=t.extend({imageUrl:t(this).attr("data-image-url")},r),r=t(o).val().replace(/[^0-9\,]/gi,""),a=r.length?r.split(",").map(function(t){return parseInt(t,10)}):[],r=t('<button type="button" class="btn"><i class="icon-trash"></i>Очистить</button>'),i=t("<canvas>"),u=i[0].getContext("2d"),s=new Image,g=function(){i.attr("height",s.height).attr("width",s.width),c()},t(s).load(g),s.src=e.imageUrl,s.loaded&&g(),i.css({background:"url("+s.src+")"}),t(o).after("<br>",i,"<br>",r),l=function(e){e.offsetX||(e.offsetX=e.pageX-t(e.target).offset().left,e.offsetY=e.pageY-t(e.target).offset().top),a[f]=Math.round(e.offsetX),a[f+1]=Math.round(e.offsetY),c()},h=function(e){e.offsetX||(e.offsetX=e.pageX-t(e.target).offset().left,e.offsetY=e.pageY-t(e.target).offset().top),p||(p={x:Math.round(e.offsetX),y:Math.round(e.offsetY)}),e={x:Math.round(e.offsetX),y:Math.round(e.offsetY)};for(var n=0;n<a.length;n++)a[n]=e.x-p.x+a[n],a[++n]=e.y-p.y+a[n];p=e,c()},c=function(){if(u.canvas.width=u.canvas.width,d(),!(2>a.length)){if(u.globalCompositeOperation="destination-over",u.fillStyle="rgb(255,255,255)",u.strokeStyle="rgb(255,20,20)",u.lineWidth=1,6<=a.length){var t=getCenter();u.fillRect(t.x-4,t.y-4,8,8)}for(u.beginPath(),u.moveTo(a[0],a[1]),t=0;t<a.length;t+=2)u.fillRect(a[t]-2,a[t+1]-2,4,4),u.strokeRect(a[t]-2,a[t+1]-2,4,4),2<a.length&&1<t&&u.lineTo(a[t],a[t+1]);u.closePath(),u.fillStyle="rgba(255,0,0,0.3)",u.fill(),u.stroke()}},d=function(){t(o).val(a.join(","))},getCenter=function(){for(var t=[],e=0;e<a.length;e++)t.push({x:a[e],y:a[++e]});var n=t[0],o=t[t.length-1];n.x==o.x&&n.y==o.y||t.push(n);var r,f,i,u=o=n=0,s=t.length;e=0;for(f=s-1;e<s;f=e++)r=t[e],f=t[f],n+=i=r.x*f.y-f.x*r.y,o+=(r.x+f.x)*i,u+=(r.y+f.y)*i;return{x:o/(i=3*n),y:u/i}},t(o).on("change",function(){var e=t(o).val().replace(/[^0-9\,]/gi,"");a=e.length?e.split(",").map(function(t){return parseInt(t,10)}):[],c()}),t(document).find(r).click(function(){a=[],c()}),t(document).find(i).on("mousedown",function(e){var o,r=a.length;if(3===e.which)return!1;if(e.preventDefault(),e.offsetX||(e.offsetX=e.pageX-t(e.target).offset().left,e.offsetY=e.pageY-t(e.target).offset().top),o=e.offsetX,e=e.offsetY,6<=a.length){var i=getCenter();if(u.fillRect(i.x-4,i.y-4,8,8),6>Math.sqrt(Math.pow(o-i.x,2)+Math.pow(e-i.y,2)))return p=!1,t(this).on("mousemove",h),!1}for(i=0;i<a.length;i+=2)if(6>Math.sqrt(Math.pow(o-a[i],2)+Math.pow(e-a[i+1],2)))return f=i,t(this).on("mousemove",l),!1;for(i=0;i<a.length;i+=2)1<i&&(6>n(o,e,a[i],a[i+1],a[i-2],a[i-1],!0)&&(r=i));return a.splice(r,0,Math.round(o),Math.round(e)),f=r,t(this).on("mousemove",l),c(),d(),!1}),t(document).find(i).on("contextmenu",function(e){e.preventDefault(),e.offsetX||(e.offsetX=e.pageX-t(e.target).offset().left,e.offsetY=e.pageY-t(e.target).offset().top);var n=e.offsetX;e=e.offsetY;for(var o=0;o<a.length;o+=2)if(dis=Math.sqrt(Math.pow(n-a[o],2)+Math.pow(e-a[o+1],2)),6>dis){a.splice(o,2),c(),d();break}return!1}),t(document).find(i).on("mouseup",function(){t(this).off("mousemove"),d(),f=null})};t(document).ready(function(){t(".canvas-area[data-image-url]").canvasAreaDraw()});var n=function(t,e,n,o,r,a,f){function i(t,e,n,o){return Math.sqrt((t-=n)*t+(e-=o)*e)}if(f&&!((f=function(t,e,n,o,r,a){if(!(r-n))return{x:n,y:e};if(!(a-o))return{x:t,y:o};var f,i=-1/((a-o)/(r-n));return{x:f=(r*(t*i-e+o)+n*(t*-i+e-a))/(i*(r-n)+o-a),y:i*f-i*t+e}}(t,e,n,o,r,a)).x>=Math.min(n,r)&&f.x<=Math.max(n,r)&&f.y>=Math.min(o,a)&&f.y<=Math.max(o,a)))return(n=i(t,e,n,o))>(t=i(t,e,r,a))?t:n;f=o-a;var u=r-n;return Math.abs(f*t+u*e+(n*a-o*r))/Math.sqrt(f*f+u*u)}}(jQuery)}});
//# sourceMappingURL=image-polygon.js.map